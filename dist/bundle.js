!function t(e,s,i){function l(r,n){if(!s[r]){if(!e[r]){var o="function"==typeof require&&require;if(!n&&o)return o(r,!0);if(h)return h(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var c=s[r]={exports:{}};e[r][0].call(c.exports,(function(t){return l(e[r][1][t]||t)}),c,c.exports,t,e,s,i)}return s[r].exports}for(var h="function"==typeof require&&require,r=0;r<i.length;r++)l(i[r]);return l}({1:[function(t,e,s){"use strict";var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(l,h){function r(t){try{o(i.next(t))}catch(t){h(t)}}function n(t){try{o(i.throw(t))}catch(t){h(t)}}function o(t){var e;t.done?l(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,n)}o((i=i.apply(t,e||[])).next())}))};Object.defineProperty(s,"__esModule",{value:!0});const l=t("./input"),h=t("./tilemap"),r=t("./scene"),n=t("./rng"),o=t("./render"),a=t("./create.hero");!function(){i(this,void 0,void 0,(function*(){const t=new h.TileRegistry;yield t.load();const e=new o.Render,s=new n.RNG,i=new l.Joystick,c=new r.SceneController;c.setScene(new a.SelectHeroScene(s,i,t,c)),function t(){c.render(e),window.requestAnimationFrame(t)}()}))}()},{"./create.hero":3,"./input":7,"./render":11,"./rng":12,"./scene":13,"./tilemap":14}],2:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./monster");s.mossMonsterNames=["ogre","big_zombie","big_demon"];s.BossMonster=class{constructor(t,e,s,l,h,r,n){this.rng=t,this.registry=e,this.level=s,this.x=l,this.y=h,this.new_x=l,this.new_y=h,this.is_left=!1,this.name=r,this.healthMax=50+Math.floor(10*s.level),this.health=this.healthMax,this.damage=7,this.luck=.5,this.speed=100,this.wrapper=new i.MovingMonsterWrapper(this),this.setAnimation(i.MonsterState.Idle,n)}setAnimation(t,e){switch(t){case i.MonsterState.Idle:this.state=t,this.tile=this.registry.get(this.name+"_idle_anim"),this.frame=0,this.start=e;break;case i.MonsterState.Run:this.state=t,this.tile=this.registry.get(this.name+"_run_anim"),this.frame=0,this.start=e}}animate(t){if(this.frame=Math.floor((t-this.start)/this.speed),this.frame>=this.tile.numOfFrames){this.state===i.MonsterState.Run&&(this.level.monsters[this.y][this.x]=null,this.level.monsters[this.y][this.x+1]=null,this.level.monsters[this.y-1][this.x]=null,this.level.monsters[this.y-1][this.x+1]=null,this.level.monsters[this.new_y][this.new_x]=this,this.level.monsters[this.new_y][this.new_x+1]=this.wrapper,this.level.monsters[this.new_y-1][this.new_x]=this.wrapper,this.level.monsters[this.new_y-1][this.new_x+1]=this.wrapper,this.x=this.new_x,this.y=this.new_y),this.setAnimation(i.MonsterState.Idle,t);const e=5,s=Math.max(0,this.x-e),l=Math.max(0,this.y-e),h=Math.min(this.level.w,this.x+e),r=Math.min(this.level.h,this.y+e);if(!this.level.hero.dead&&this.level.hero.x>=s&&this.level.hero.x<=h&&this.level.hero.y>=l&&this.level.hero.y<=r){const e=Math.abs(this.x-this.level.hero.x),s=Math.abs(this.y-this.level.hero.y);if(e>1){const e=Math.max(-1,Math.min(1,this.level.hero.x-this.x));if(this.move(e,0,t))return void console.log("move to hero x")}if(s>0){const e=Math.max(-1,Math.min(1,this.level.hero.y-this.y));if(this.move(0,e,t))return void console.log("move to hero y")}if(e<=1&&s<=1&&this.rng.nextFloat()<this.luck)return void this.level.hero.hitDamage(this.damage,this.name,t)}const n=.5;if(this.rng.nextFloat()<n){const e=this.rng.nextRange(-1,2),s=this.rng.nextRange(-1,2);if(console.log("random move",e,s),this.move(e,s,t))return}}}move(t,e,s){if(this.is_left=t<0,this.state===i.MonsterState.Idle){const l=this.x+t,h=this.y+e;for(let t=l;t<=l+1;t++)for(let e=h-1;e<=h;e++){if(!this.level.floor[e][t])return!1;const s=this.level.monsters[e][t];if(s&&s!==this&&s!==this.wrapper)return!1}return this.level.monsters[h][l]=this.wrapper,this.level.monsters[h][l+1]=this.wrapper,this.level.monsters[h-1][l]=this.wrapper,this.level.monsters[h-1][l+1]=this.wrapper,this.level.monsters[this.y][this.x]=this,this.new_x=l,this.new_y=h,this.setAnimation(i.MonsterState.Run,s),!0}return!1}hitDamage(t,e,s){this.level.log.push(`${this.name} damaged ${t} by ${e}`),this.health=Math.max(0,this.health-t),this.health<=0&&(this.level.log.push(`${this.name} killed by ${e}`),this.level.monsters[this.y][this.x]=null,this.level.monsters[this.y][this.x+1]=null,this.level.monsters[this.y-1][this.x]=null,this.level.monsters[this.y-1][this.x+1]=null,this.level.monsters[this.new_y][this.new_x]=null,this.level.monsters[this.new_y][this.new_x+1]=null,this.level.monsters[this.new_y-1][this.new_x]=null,this.level.monsters[this.new_y-1][this.new_x+1]=null,this.level.boss=null,this.rng.nextFloat()<this.luck&&this.level.randomDrop(this.x,this.y))}}},{"./monster":10}],3:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./hero"),l=t("./drop"),h=t("./dungeon");s.SelectHeroScene=class{constructor(t,e,s,i){this.selected=0,this.rng=t,this.joystick=e,this.registry=s,this.controller=i}render(t){this.handleInput();const e=(new Date).getTime(),s=t.canvas.width,i=t.canvas.height;t.ctx.save(),t.ctx.fillStyle="rgb(34,34,34)",t.ctx.fillRect(0,0,s,i),this.renderTitle(t),this.renderHeroes(t,e),t.ctx.restore()}renderTitle(t){t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.font="100px silkscreennormal",t.ctx.fillStyle="rgb(255,255,255)",t.ctx.fillText("ROGUELIKE DUNGEON",t.canvas.width>>1,100)}renderHeroes(t,e){const s=t.canvas.width,l=t.canvas.height,h=i.heroMonsterNames.length,r=Math.floor(s/h),n=Math.floor(r/10);for(let s=0;s<h;s++){const h=i.heroMonsterNames[s],o=this.registry.get(h+"_idle_anim"),a=r*s+n,c=(l>>1)-(r>>1),w=r-(n<<1),d=Math.floor(w/o.w),m=Math.floor(o.h*d);let g=0;if(o.isAnim&&o.numOfFrames>1){g=Math.floor(e/100)%o.numOfFrames*o.w}this.selected===s?t.ctx.fillStyle="rgb(90, 90, 90)":t.ctx.fillStyle="rgb(50, 50, 50)",t.ctx.fillRect(a-(n>>1),c+n,w+n,m),t.ctx.drawImage(o.tileSet,o.x+g,o.y,o.w,o.h,a,c,w,m),this.selected===s&&(t.ctx.textAlign="center",t.ctx.textBaseline="top",t.ctx.font="20px silkscreennormal",t.ctx.fillStyle="rgb(255,255,255)",t.ctx.fillText(h,a+(w>>1),c-20,w))}}handleInput(){if(this.joystick.moveLeft.processed||(this.joystick.moveLeft.processed=!0,0===this.selected?this.selected=i.heroMonsterNames.length-1:this.selected--),this.joystick.moveRight.processed||(this.joystick.moveRight.processed=!0,this.selected=(this.selected+1)%i.heroMonsterNames.length),!this.joystick.hit.processed){this.joystick.hit.processed=!0;const t=i.heroMonsterNames[this.selected],e=l.WeaponConfig.configs[0].create(this.registry),s=new i.HeroMonster(this.registry,this.joystick,0,0,t,e,0),r=new h.DungeonScene(this.rng,this.joystick,this.registry,this.controller,s);this.controller.setScene(r)}}}},{"./drop":4,"./dungeon":5,"./hero":6}],4:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.Coins=class{constructor(t,e){this.tile=e.get("coin_anim"),this.coins=t.nextRange(1,30)}pickedUp(t){return t.addCoins(this.coins),!0}};class i{constructor(t){this.tile=t.get("flask_red"),this.health=2}pickedUp(t){return t.inventory.add(this)}same(t){return t instanceof i}use(t,e){e.hill(this.health),t.count--,t.count<=0&&(t.item=null,t.count=0)}}s.HealthFlask=i;class l{constructor(t){this.tile=t.get("flask_big_red"),this.health=5}pickedUp(t){return t.inventory.add(this)}same(t){return t instanceof l}use(t,e){e.hill(this.health),t.count--,t.count<=0&&(t.item=null,t.count=0)}}s.HealthBigFlask=l,s.weaponNames=["weapon_knife","weapon_rusty_sword","weapon_regular_sword","weapon_red_gem_sword","weapon_big_hammer","weapon_hammer","weapon_baton_with_spikes","weapon_mace","weapon_katana","weapon_saw_sword","weapon_anime_sword","weapon_axe","weapon_machete","weapon_cleaver","weapon_duel_sword","weapon_knight_sword","weapon_golden_sword","weapon_lavish_sword","weapon_red_magic_staff","weapon_green_magic_staff"];class h{constructor(t,e,s,i,l){this.tileName=t,this.speed=e,this.distance=s,this.damage=i,this.level=l}create(t){return new r(t.get(this.tileName),this.speed,this.distance,this.damage)}}s.WeaponConfig=h,h.configs=[new h("weapon_knife",100,1,3,1),new h("weapon_rusty_sword",100,1,4,1),new h("weapon_regular_sword",100,1,5,3),new h("weapon_red_gem_sword",100,1,6,3),new h("weapon_big_hammer",300,2,10,5),new h("weapon_hammer",200,1,7,5),new h("weapon_baton_with_spikes",200,1,7,5),new h("weapon_mace",200,1,7,5),new h("weapon_katana",100,1,8,7),new h("weapon_saw_sword",200,1,9,7),new h("weapon_anime_sword",200,1,12,7),new h("weapon_axe",200,1,12,7),new h("weapon_machete",100,1,11,9),new h("weapon_cleaver",100,1,12,9),new h("weapon_duel_sword",100,1,13,9),new h("weapon_knight_sword",100,1,14,9),new h("weapon_golden_sword",100,1,15,11),new h("weapon_lavish_sword",100,1,16,11)];class r{constructor(t,e,s,i){this.tile=t,this.frame=0,this.numOfFrames=4,this.speed=e,this.distance=s,this.damage=i}pickedUp(t){return t.inventory.add(this)}same(t){return!1}use(t,e){const s=e.weapon;e.weapon=this,s?(t.item=s,t.count=1):(t.item=null,t.count=0)}}s.Weapon=r},{}],5:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./level"),l=t("./monster");s.DungeonScene=class{constructor(t,e,s,l,h){this.controller=l;const r=(new Date).getTime();this.level=new i.Level(t,s,this,h,1,r)}setLevel(t){this.level=t}render(t){const e=(new Date).getTime();this.level.animate(e),this.renderLevel(t,e),this.renderHUD(t,e)}renderLevel(t,e){const s=t.canvas.width,i=t.canvas.height;t.buffer.width=s,t.buffer.height=i,t.ctx.save(),t.ctx.fillStyle="rgb(34,34,34)",t.ctx.fillRect(0,0,s,i),t.b_ctx.save(),t.b_ctx.fillStyle="black",t.b_ctx.fillRect(0,0,s,i),t.b_ctx.globalCompositeOperation="lighter",this.renderLight(t,s>>1,i>>1,192);let h=16*this.level.hero.x*2+8-s/2,r=16*this.level.hero.y*2+8-i/2;if(this.level.hero.state===l.MonsterState.Run){const t=this.level.hero.start,s=this.level.hero.speed*this.level.hero.tile.numOfFrames,i=Math.min(s,e-t)/s;h+=32*(this.level.hero.new_x-this.level.hero.x)*i,r+=32*(this.level.hero.new_y-this.level.hero.y)*i}for(let s=0;s<this.level.w;s++)for(let i=0;i<this.level.h;i++){const l=16*s*2-h,n=16*i*2-r;this.renderTile(t,this.level.floor[i][s],l,n,e),this.level.drop[i][s]&&this.renderTile(t,this.level.drop[i][s].tile,l,n,e)}for(let s=0;s<this.level.h;s++){for(let i=0;i<this.level.w;i++){const l=16*i*2-h,n=16*s*2-r,o=this.level.wall[s][i];o&&(this.renderTile(t,o,l,n,e),"wall_fountain_mid_red_anim"!==o.name&&"wall_fountain_mid_blue_anim"!==o.name||this.renderLight(t,l+16,n+16,128))}if(s<this.level.h-1)for(let i=0;i<this.level.w;i++){const l=s+1,n=16*i*2-h,o=16*l*2-r;this.renderMonster(t,this.level.monsters[l][i],n,o,e)}}t.ctx.restore(),t.ctx.save(),t.ctx.globalAlpha=.8,t.ctx.globalCompositeOperation="multiply",t.ctx.drawImage(t.buffer,0,0),t.ctx.restore()}renderLight(t,e,s,i){const l=i<<1,h=e-i,r=s-i,n=t.b_ctx.createRadialGradient(e,s,16,e,s,i);n.addColorStop(.5,"rgb(255,255,255)"),n.addColorStop(1,"transparent"),t.b_ctx.fillStyle=n,t.b_ctx.fillRect(h,r,l,l)}renderHUD(t,e){this.renderHealth(t,e),this.renderLevelTitle(t,e),this.renderYouDead(t,e),this.renderInventory(t,e)}renderHealth(t,e){const s=this.level.hero.healthMax,i=this.level.hero.health;t.ctx.save(),t.ctx.translate(40,40),t.ctx.fillStyle="rgb(0,0,0)",t.ctx.fillRect(0,0,8+10*s,28),t.ctx.fillStyle="rgb(255,0,0)",t.ctx.fillRect(4,4,10*i,20),t.ctx.fillStyle="rgb(255,255,255)",t.ctx.font="20px silkscreennormal",t.ctx.fillText(i.toString(),8,20),t.ctx.fillText(`$${this.level.hero.coins}`,0,50),t.ctx.restore()}renderLevelTitle(t,e){const s=t.canvas.width,i=t.canvas.height;if(t.ctx.save(),t.ctx.translate(s/2,60),t.ctx.fillStyle="rgb(255,255,255)",t.ctx.textAlign="center",t.ctx.font="20px silkscreennormal",t.ctx.fillText(`level ${this.level.level}`,0,0),t.ctx.restore(),this.level.boss){t.ctx.save(),t.ctx.translate(s/2,100);const e=4,i=20,l=500,h=this.level.boss.healthMax,r=this.level.boss.health,n=Math.min(10,Math.floor(l/h)),o=2*e+n*h;t.ctx.fillStyle="rgb(0,0,0)",t.ctx.fillRect(-(o>>1),0,o,2*e+i);const a=n*r;t.ctx.fillStyle="rgb(255,0,0)",t.ctx.fillRect(e-(n*h>>1),e,a,i),t.ctx.fillStyle="rgb(255,255,255)",t.ctx.font="20px silkscreennormal",t.ctx.fillText(`${this.level.boss.name} - ${r}`,2*e-(n*h>>1),e+16),t.ctx.restore()}this.level.log=this.level.log.slice(-5),t.ctx.save(),t.ctx.translate(40,i-100);for(let e=0;e<this.level.log.length;e++)t.ctx.fillStyle="rgb(255,255,255)",t.ctx.font="20px silkscreennormal",t.ctx.fillText(this.level.log[e],0,20*e);t.ctx.restore()}renderYouDead(t,e){const s=t.canvas.width,i=t.canvas.height;this.level.hero.dead&&(t.ctx.save(),t.ctx.fillStyle="rgba(0, 0, 0, 0.7)",t.ctx.fillRect(0,0,s,i),t.ctx.translate(s/2,i/2),t.ctx.fillStyle="rgb(255,0,0)",t.ctx.textAlign="center",t.ctx.font="200px silkscreennormal",t.ctx.fillText("YOU DIED",0,0),t.ctx.restore())}renderInventory(t,e){const s=t.canvas.width,i=t.canvas.height,l=this.level.hero.inventory.cells,h=l.length,r=2*(18*h+2);t.ctx.save(),t.ctx.translate((s>>1)-(r>>1),i-40-40),t.ctx.fillStyle="rgb(100,100,100)",t.ctx.fillRect(0,0,r,40),t.ctx.translate(4,4);for(let s=0;s<h;s++){const i=18*s*2,h=0;t.ctx.fillStyle="rgb(70,70,70)",t.ctx.fillRect(i,0,32,32);const r=l[s];if(r.item){const s=r.item.tile;let l=s.x;const n=s.y,o=s.w,a=s.h;if(s.isAnim&&s.numOfFrames>1){const t=Math.floor(e/100)%s.numOfFrames;l=s.x+o*t}const c=a<=16?1:16/a,w=2*o*c,d=2*a*c,m=16-(w>>1);t.ctx.drawImage(s.tileSet,l,n,o,a,i+m,h,w,d),t.ctx.textAlign="end",t.ctx.textBaseline="top",t.ctx.font="10px silkscreennormal",t.ctx.fillStyle="rgb(255,255,255)",t.ctx.fillText(r.count.toString(),i+32,0,32)}}t.ctx.restore()}renderMonster(t,e,s,i,h){if(e&&!(e instanceof l.MovingMonsterWrapper)){const r=e.tile.w,n=e.tile.h,o=e.tile.x+r*e.frame,a=e.tile.y,c=2*r,w=2*n,d=w-28;let m=0,g=0;if(e.state===l.MonsterState.Run){const t=e.start,s=e.speed*e.tile.numOfFrames,i=Math.min(s,h-t)/s;m=32*(e.new_x-e.x)*i,g=32*(e.new_y-e.y)*i}if(s+m+c>0&&s+m<t.canvas.width&&i+g+w>0&&i+g<t.canvas.height){if(t.ctx.save(),t.ctx.translate(s+m,i+g),e.is_left){if(t.ctx.scale(-1,1),e.weapon){t.ctx.save();const s=e.weapon.tile,i=2*s.w,h=2*s.h,r=h-28,n=8;if(t.ctx.translate(-n,-r),e.state===l.MonsterState.Hit){let l=90*e.weapon.frame/(e.weapon.numOfFrames-1);t.ctx.translate(i>>1,h),t.ctx.rotate(l*Math.PI/180),t.ctx.drawImage(s.tileSet,s.x,s.y,s.w,s.h,-(i>>1),-h,i,h)}else t.ctx.drawImage(s.tileSet,s.x,s.y,s.w,s.h,0,0,i,h);t.ctx.restore()}t.ctx.drawImage(e.tile.tileSet,o,a,r,n,0-c,-d,c,w)}else{if(e.weapon){t.ctx.save();const s=e.weapon.tile,i=2*s.w,h=2*s.h,r=h-28,n=24;if(t.ctx.translate(n,-r),e.state===l.MonsterState.Hit){let l=90*e.weapon.frame/(e.weapon.numOfFrames-1);t.ctx.translate(i>>1,h),t.ctx.rotate(l*Math.PI/180),t.ctx.drawImage(s.tileSet,s.x,s.y,s.w,s.h,-(i>>1),-h,i,h)}else t.ctx.drawImage(s.tileSet,s.x,s.y,s.w,s.h,0,0,i,h);t.ctx.restore()}t.ctx.drawImage(e.tile.tileSet,o,a,r,n,0,-d,c,w)}t.ctx.restore()}}}renderTile(t,e,s,i,l){if(e){const h=e.w,r=e.h,n=2*h,o=2*r,a=o-32,c=32-n>>1;if(s+n>0&&s<t.ctx.canvas.width&&i-a+o>0&&i-a<t.ctx.canvas.height)if(e.isAnim&&e.numOfFrames>1){const w=Math.floor(l/100)%e.numOfFrames,d=e.x+h*w,m=e.y;t.ctx.drawImage(e.tileSet,d,m,h,r,s+c,i-a,n,o)}else{const l=e.x,w=e.y;t.ctx.drawImage(e.tileSet,l,w,h,r,s+c,i-a,n,o)}}}}},{"./level":9,"./monster":10}],6:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./inventory"),l=t("./monster");s.heroMonsterNames=["elf_f","elf_m","knight_f","knight_m","wizard_f","wizard_m"];s.HeroMonster=class{constructor(t,e,s,h,r,n,o){this.registry=t,this.joystick=e,this.x=s,this.y=h,this.new_x=s,this.new_y=h,this.is_left=!1,this.name=r,this.healthMax=30,this.health=this.healthMax,this.coins=0,this.baseDamage=1,this.dead=!1,this.weapon=n,this.speed=100,this.inventory=new i.Inventory,this.setAnimation(l.MonsterState.Idle,o)}get damage(){return this.baseDamage+(this.weapon?this.weapon.damage:0)}setLevel(t){this.level=t}setAnimation(t,e){switch(t){case l.MonsterState.Idle:this.state=t,this.tile=this.registry.get(this.name+"_idle_anim"),this.frame=0,this.start=e;break;case l.MonsterState.Run:this.dead||(this.state=t,this.tile=this.registry.get(this.name+"_run_anim"),this.frame=0,this.start=e);break;case l.MonsterState.Hit:this.dead||(this.state=t,this.tile=this.registry.get(this.name+"_hit_anim"),this.frame=0,this.weapon&&(this.weapon.frame=0),this.start=e)}}animate(t){switch(this.state){case l.MonsterState.Idle:this.frame=Math.floor((t-this.start)/this.speed),this.action(t)||this.frame>=this.tile.numOfFrames&&this.setAnimation(l.MonsterState.Idle,t);break;case l.MonsterState.Run:this.frame=Math.floor((t-this.start)/this.speed),this.frame>=this.tile.numOfFrames&&(this.level.monsters[this.y][this.x]=null,this.level.monsters[this.new_y][this.new_x]=this,this.x=this.new_x,this.y=this.new_y,this.scanDrop(),this.action(t)||this.setAnimation(l.MonsterState.Idle,t));break;case l.MonsterState.Hit:this.weapon?(this.weapon.frame=Math.floor((t-this.start)/this.weapon.speed),this.weapon.frame>=this.weapon.numOfFrames&&(this.scanHit(t),this.scanDrop(),this.action(t)||this.setAnimation(l.MonsterState.Idle,t))):(this.frame=Math.floor((t-this.start)/this.speed),this.frame>=this.tile.numOfFrames&&(this.scanHit(t),this.scanDrop(),this.action(t)||this.setAnimation(l.MonsterState.Idle,t)))}}action(t){if(!this.dead){this.scanDrop();for(let t=0;t<10;t++){const e=(t+1)%10;this.joystick.digit(e).processed||(this.joystick.digit(e).processed=!0,this.inventory.cells[t].use(this))}if(this.joystick.drop.processed||(this.joystick.drop.processed=!0,this.dropWeapon()),this.joystick.hit.triggered&&!this.joystick.hit.processed)return"floor_ladder"===this.level.floor[this.y][this.x].name?(this.joystick.hit.processed=!0,this.level.exit(t),!0):(this.setAnimation(l.MonsterState.Hit,t),!0);if((this.joystick.moveUp.triggered||!this.joystick.moveUp.processed)&&(this.joystick.moveUp.processed=!0,this.move(0,-1,t)))return!0;if((this.joystick.moveDown.triggered||!this.joystick.moveDown.processed)&&(this.joystick.moveDown.processed=!0,this.move(0,1,t)))return!0;if((this.joystick.moveLeft.triggered||!this.joystick.moveLeft.processed)&&(this.joystick.moveLeft.processed=!0,this.is_left=!0,this.move(-1,0,t)))return!0;if((this.joystick.moveRight.triggered||!this.joystick.moveRight.processed)&&(this.joystick.moveRight.processed=!0,this.is_left=!1,this.move(1,0,t)))return!0}return!1}dropWeapon(){if(this.weapon){const t=5;let e=this.x,s=this.x,i=this.y,l=this.y;for(let h=0;h<t;h++){e--,s++,i--,l++;let t=this.y,r=this.y;for(let i=0;i<=h;i++){let i=this.is_left?[e,s]:[s,e],l=[t,r];for(let t=0;t<2;t++){let e=i[t];for(let t=0;t<2;t++){let s=l[t];if(e>=0&&s>=0&&!this.level.drop[s][e]&&this.level.floor[s][e]){const t=this.weapon;return this.weapon=null,void(this.level.drop[s][e]=t)}}}t--,r++}for(let i=0;i<h;h++){e++,s--;let i=this.is_left?[e,s]:[s,e],l=[t,r];for(let t=0;t<2;t++){let e=i[t];for(let t=0;t<2;t++){let s=l[t];if(e>=0&&s>=0&&!this.level.drop[s][e]&&this.level.floor[s][e]){const t=this.weapon;return this.weapon=null,void(this.level.drop[s][e]=t)}}}}}}}scanDrop(){if(this.level.drop[this.y][this.x]){this.level.drop[this.y][this.x].pickedUp(this)&&(this.level.drop[this.y][this.x]=null)}}scanHit(t){const e=this.weapon?this.weapon.distance:1,s=this.is_left?Math.max(0,this.x-e):this.x,i=this.is_left?this.x:Math.min(this.level.w,this.x+e),l=Math.max(0,this.y-e),h=Math.min(this.level.h,this.y+e);for(let e=l;e<=h;e++)for(let l=s;l<=i;l++)if(l!==this.x||e!==this.y){const s=this.level.monsters[e][l];s&&s.hitDamage(this.damage,this.name,t)}}move(t,e,s){if(!this.dead&&this.state===l.MonsterState.Idle){const i=this.x+t,h=this.y+e;return!!this.level.floor[h][i]&&(!this.level.monsters[h][i]&&(this.level.monsters[h][i]=new l.MovingMonsterWrapper(this),this.new_x=i,this.new_y=h,this.setAnimation(l.MonsterState.Run,s),!0))}return!1}resetPosition(t,e){this.x=t,this.y=e,this.new_x=t,this.new_y=e}hitDamage(t,e,s){this.dead||(this.level.log.push(`${this.name} damaged ${t} by ${e}`),this.health=Math.max(0,this.health-t),this.health<=0&&(this.level.log.push(`${this.name} killed by ${e}`),this.setAnimation(l.MonsterState.Idle,s),this.dead=!0))}hill(t){this.health=Math.min(this.healthMax,this.health+t)}addCoins(t){this.coins=this.coins+t}}},{"./inventory":8,"./monster":10}],7:[function(t,e,s){"use strict";var i;Object.defineProperty(s,"__esModule",{value:!0}),function(t){t[t.Await=1]="Await",t[t.Pressed=2]="Pressed"}(i||(i={}));class l{constructor(t){this.code=t,this.state=i.Await,this.triggered=!1,this.processed=!0}keydown(t){t.code===this.code&&(t.preventDefault(),this.state===i.Await&&(this.triggered=!0,this.processed=!1,this.state=i.Pressed))}keyup(t){t.code===this.code&&(t.preventDefault(),this.state===i.Pressed&&(this.triggered=!1,this.state=i.Await))}}s.KeyBind=l;s.Joystick=class{constructor(){this.moveUp=new l("KeyW"),this.moveLeft=new l("KeyA"),this.moveDown=new l("KeyS"),this.moveRight=new l("KeyD"),this.hit=new l("KeyF"),this.drop=new l("KeyQ"),this.digit1=new l("Digit1"),this.digit2=new l("Digit2"),this.digit3=new l("Digit3"),this.digit4=new l("Digit4"),this.digit5=new l("Digit5"),this.digit6=new l("Digit6"),this.digit7=new l("Digit7"),this.digit8=new l("Digit8"),this.digit9=new l("Digit9"),this.digit0=new l("Digit0"),this.init()}digit(t){switch(t){case 1:return this.digit1;case 2:return this.digit2;case 3:return this.digit3;case 4:return this.digit4;case 5:return this.digit5;case 6:return this.digit6;case 7:return this.digit7;case 8:return this.digit8;case 9:return this.digit9;case 0:return this.digit0}}init(){window.addEventListener("keydown",this.keydown.bind(this)),window.addEventListener("keyup",this.keyup.bind(this))}keydown(t){this.moveUp.keydown(t),this.moveLeft.keydown(t),this.moveDown.keydown(t),this.moveRight.keydown(t),this.hit.keydown(t),this.drop.keydown(t),this.digit1.keydown(t),this.digit2.keydown(t),this.digit3.keydown(t),this.digit4.keydown(t),this.digit5.keydown(t),this.digit6.keydown(t),this.digit7.keydown(t),this.digit8.keydown(t),this.digit9.keydown(t),this.digit0.keydown(t)}keyup(t){this.moveUp.keyup(t),this.moveLeft.keyup(t),this.moveDown.keyup(t),this.moveRight.keyup(t),this.hit.keyup(t),this.drop.keyup(t),this.digit1.keyup(t),this.digit2.keyup(t),this.digit3.keyup(t),this.digit4.keyup(t),this.digit5.keyup(t),this.digit6.keyup(t),this.digit7.keyup(t),this.digit8.keyup(t),this.digit9.keyup(t),this.digit0.keyup(t)}}},{}],8:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.Inventory=class{constructor(){this.cells=[];for(let t=0;t<10;t++)this.cells[t]=new i}add(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].stack(t))return!0;for(let e=0;e<this.cells.length;e++)if(this.cells[e].set(t))return!0;return!1}};class i{constructor(){this.maxInStack=3,this.item=null,this.count=0}stack(t){return!!(this.item&&this.item.same(t)&&this.count<this.maxInStack)&&(this.count++,!0)}set(t){return!this.item&&(this.item=t,this.count=1,!0)}use(t){return!!(this.item&&this.count>0)&&(this.item.use(this,t),!0)}}s.InventoryCell=i},{}],9:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./tiny.monster"),l=t("./drop"),h=t("./boss.monster");class r{constructor(t,e,s,i){this.x=t,this.y=e,this.w=s,this.h=i}expand(){const t=this;return new r(t.x-2,t.y-3,t.w+2+2,t.h+3+3)}expandV(){const t=this;return new r(t.x-2,t.y,t.w+2+2,t.h)}expandH(){const t=this;return new r(t.x,t.y-3,t.w,t.h+3+3)}isOverlap(t){const e=this;return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y}}s.Rect=r;class n{constructor(t,e,s,i,l,h){this.rng=t,this.registry=e,this.scene=s,this.level=l,this.w=200,this.h=120,this.log=[],this.rooms=[],this.corridorsV=[],this.corridorsH=[],this.floor=this.createBuffer(()=>null),this.drop=this.createBuffer(()=>null),this.wall=this.createBuffer(()=>null),this.monsterList=[],this.hero=i,this.monsters=this.createBuffer(()=>null),this.generate(h),this.fill(),this.replace()}createBuffer(t){const e=[];for(let s=0;s<this.h;s++){const s=[];e.push(s);for(let e=0;e<this.w;e++)s.push(t())}return e}generate(t){const e=1+this.level,s=3+this.level,l=5+this.level,r=this.level%5==0;for(let t=0;t<e;t++)this.generateRoom();const n=this.rooms.length-(r?1:0);if(n>1)for(let e=0;e<s;e++){const e=this.rng.nextRange(1,n),s=this.rooms[e];for(let e=0;e<10;e++){const e=s.x+this.rng.nextRange(0,s.w),l=s.y+this.rng.nextRange(0,s.h);if(!this.monsters[l][e]){const s=this.rng.choice(i.tinyMonsterNames),h=new i.TinyMonster(this.rng,this.registry,this,e,l,s,t);this.monsterList.push(h),this.monsters[l][e]=h;break}}}if(r){const e=this.rooms[this.rooms.length-1];for(let s=0;s<10;s++){const s=e.x+this.rng.nextRange(1,e.w),i=e.y+this.rng.nextRange(1,e.h);if(!(this.monsters[i][s]||this.monsters[i][s+1]||this.monsters[i-1][s]||this.monsters[i-1][s+1])){const e=h.mossMonsterNames[Math.floor(this.level/5)%h.mossMonsterNames.length],l=new h.BossMonster(this.rng,this.registry,this,s,i,e,t);this.boss=l,this.monsters[i][s]=l;break}}}for(let t=0;t<l;t++){const t=this.rng.choice(this.rooms);for(let e=0;e<10;e++){const e=t.x+this.rng.nextRange(0,t.w),s=t.y+this.rng.nextRange(0,t.h);if(!this.drop[s][e]){this.randomDrop(e,s);break}}}{const t=this.rooms[0],e=t.x+(t.w>>1),s=t.y+(t.h>>1);this.hero.setLevel(this),this.hero.resetPosition(e,s),this.monsters[s][e]=this.hero}}generateRoom(){for(let t=0;t<1e3;t++){const t=this.rng.nextRange(5,15),e=this.rng.nextRange(3,10),s=new r(this.rng.nextRange(2,this.w-2-t),this.rng.nextRange(2,this.h-2-e),t,e);if(!this.isOverlap(s.expand())){if(0===this.rooms.length){this.rooms.push(s);break}{const t=s;let e=!1;for(let s=0;s<this.rooms.length;s++){let i=this.rooms[s];const l=Math.max(t.x,i.x),h=Math.min(t.x+t.w,i.x+i.w);if(l+5<=h){let s;s=t.y+t.h<i.y?new r(l+2,t.y+t.h,h-l-4,i.y-t.y-t.h):new r(l+2,i.y+i.h,h-l-4,t.y-i.y-i.h),s.h<12&&!this.isOverlap(s.expandV())&&(this.corridorsV.push(s),e=!0)}const n=Math.max(t.y,i.y),o=Math.min(t.y+t.h,i.y+i.h);if(n+3<=o){let s;s=t.x+t.w<i.x?new r(t.x+t.w,n+1,i.x-t.x-t.w,o-n-2):new r(i.x+i.w,n+1,t.x-i.x-i.w,o-n-2),s.w<12&&!this.isOverlap(s.expandH())&&(this.corridorsH.push(s),e=!0)}}if(e){console.log("add room",s),this.rooms.push(s);break}}}}}isOverlap(t){const e=t.isOverlap.bind(t);return this.rooms.some(e)||this.corridorsV.some(e)||this.corridorsH.some(e)}randomDrop(t,e){const s=53*this.rng.nextFloat();if(s<3){const s=l.WeaponConfig.configs.filter(t=>t.level<=this.level);this.drop[e][t]=this.rng.choice(s).create(this.registry)}else s<10?this.drop[e][t]=new l.HealthBigFlask(this.registry):s<10?this.drop[e][t]=new l.HealthFlask(this.registry):s<30&&(this.drop[e][t]=new l.Coins(this.rng,this.registry))}fill(){this.rooms.forEach(t=>this.fillRoom(t.x,t.y,t.w,t.h)),this.corridorsH.forEach(t=>this.fillCorridorH(t.x,t.y,t.w,t.h)),this.corridorsV.forEach(t=>this.fillCorridorV(t.x,t.y,t.w,t.h))}fillRoom(t,e,s,i){for(let l=e;l<e+i;l++)for(let e=t;e<t+s;e++)this.floor[l][e]=this.registry.get("floor_1");if(this.wall[e-2][t]=this.registry.get("wall_corner_top_left"),this.wall[e-1][t]=this.registry.get("wall_corner_left"),s>1){for(let i=t+1;i<t+s-1;i++)this.wall[e-2][i]=this.registry.get("wall_top_mid"),this.wall[e-1][i]=this.registry.get("wall_mid");this.wall[e-2][t+s-1]=this.registry.get("wall_corner_top_right"),this.wall[e-1][t+s-1]=this.registry.get("wall_corner_right")}if(this.wall[e+i-1][t]=this.registry.get("wall_corner_bottom_left"),this.wall[e+i][t]=this.registry.get("wall_left"),s>1){for(let l=t+1;l<t+s-1;l++)this.wall[e+i-1][l]=this.registry.get("wall_top_mid"),this.wall[e+i][l]=this.registry.get("wall_mid");this.wall[e+i-1][t+s-1]=this.registry.get("wall_corner_bottom_right"),this.wall[e+i][t+s-1]=this.registry.get("wall_right")}for(let s=e;s<e+i-1;s++)this.wall[s][t]=this.registry.get("wall_side_mid_right");for(let l=e;l<e+i-1;l++)this.wall[l][t+s-1]=this.registry.get("wall_side_mid_left")}fillCorridorH(t,e,s,i){for(let l=e;l<e+i;l++)for(let e=t;e<t+s;e++)this.floor[l][e]=this.registry.get("floor_1");switch(this.wall[e-2][t-1].name){case"wall_corner_top_right":this.wall[e-2][t-1]=this.registry.get("wall_top_mid");break;case"wall_side_mid_left":break;default:console.log("top left 2",this.wall[e-2][t-1])}switch(this.wall[e-1][t-1].name){case"wall_corner_right":this.wall[e-1][t-1]=this.registry.get("wall_mid");break;case"wall_side_mid_left":this.wall[e-1][t-1]=this.registry.get("wall_side_front_left");break;default:console.log("top left 1",this.wall[e-1][t-1])}if(i>1)for(let s=e;s<e+i-1;s++)switch(this.wall[s][t-1].name){case"wall_side_mid_left":this.wall[s][t-1]=null;break;default:console.log("mid left",this.wall[s][t-1])}switch(this.wall[e+i-1][t-1].name){case"wall_side_mid_left":this.wall[e+i-1][t-1]=this.registry.get("wall_side_top_left");break;case"wall_corner_bottom_right":this.wall[e+i-1][t-1]=this.registry.get("wall_top_mid");break;default:console.log("bottom left 0",this.wall[e+i-1][t-1])}switch(this.wall[e+i][t-1].name){case"wall_side_mid_left":break;case"wall_right":this.wall[e+i][t-1]=this.registry.get("wall_mid");break;default:console.log("bottom left 1",this.wall[e+i][t-1])}switch(this.wall[e-2][t+s].name){case"wall_corner_top_left":this.wall[e-2][t+s]=this.registry.get("wall_top_mid");break;case"wall_side_mid_right":break;default:console.log("top right 2",this.wall[e-2][t+s])}switch(this.wall[e-1][t+s].name){case"wall_corner_left":this.wall[e-1][t+s]=this.registry.get("wall_mid");break;case"wall_side_mid_right":this.wall[e-1][t+s]=this.registry.get("wall_side_front_right");break;default:console.log("top right 1",this.wall[e-1][t+s])}if(i>1)for(let l=e;l<e+i-1;l++)switch(this.wall[l][t+s].name){case"wall_side_mid_right":this.wall[l][t+s]=null;break;default:console.log("mid right",this.wall[l][t+s])}switch(this.wall[e+i-1][t+s].name){case"wall_side_mid_right":this.wall[e+i-1][t+s]=this.registry.get("wall_side_top_right");break;case"wall_corner_bottom_left":this.wall[e+i-1][t+s]=this.registry.get("wall_top_mid");break;default:console.log("bottom right 0",this.wall[e+i-1][t+s])}switch(this.wall[e+i][t+s].name){case"wall_side_mid_right":break;case"wall_left":this.wall[e+i][t+s]=this.registry.get("wall_mid");break;default:console.log("bottom right +1",this.wall[e+i][t+s])}for(let i=t;i<t+s;i++)this.wall[e-2][i]=this.registry.get("wall_top_mid"),this.wall[e-1][i]=this.registry.get("wall_mid");for(let l=t;l<t+s;l++)this.wall[e+i-1][l]=this.registry.get("wall_top_mid"),this.wall[e+i][l]=this.registry.get("wall_mid")}fillCorridorV(t,e,s,i){for(let l=e;l<e+i;l++)for(let e=t;e<t+s;e++)this.floor[l][e]=this.registry.get("floor_1");switch(this.wall[e-1][t-1].name){case"wall_top_mid":this.wall[e-1][t-1]=this.registry.get("wall_corner_top_right");break;default:console.log("top left -1 -1",this.wall[e-1][t-1])}switch(this.wall[e][t-1].name){case"wall_mid":this.wall[e][t-1]=this.registry.get("wall_corner_right");break;default:console.log("top left 0 -1",this.wall[e][t-1])}for(let i=t;i<t+s;i++){switch(this.wall[e-1][i].name){case"wall_top_mid":this.wall[e-1][i]=null;break;default:console.log("top mid -1",this.wall[e-1][i])}switch(this.wall[e][i].name){case"wall_mid":this.wall[e][i]=null;break;default:console.log("top mid 0",this.wall[e][i])}}switch(this.wall[e-1][t+s].name){case"wall_top_mid":this.wall[e-1][t+s]=this.registry.get("wall_corner_top_left");break;default:console.log("top right -1 1",this.wall[e-1][t+s])}switch(this.wall[e][t+s].name){case"wall_mid":this.wall[e][t+s]=this.registry.get("wall_corner_left");break;default:console.log("top right 0 -1",this.wall[e][t+s])}switch(this.wall[e+i-2][t-1].name){case"wall_top_mid":this.wall[e+i-2][t-1]=this.registry.get("wall_corner_bottom_right");break;default:console.log("bottom left -2 -1",this.wall[e+i-2][t-1])}switch(this.wall[e+i-1][t-1].name){case"wall_mid":this.wall[e+i-1][t-1]=this.registry.get("wall_corner_front_right");break;default:console.log("top left 0 -1",this.wall[e+i-1][t-1])}for(let l=t;l<t+s;l++){switch(this.wall[e+i-2][l].name){case"wall_top_mid":this.wall[e+i-2][l]=null;break;default:console.log("bottom mid -2",this.wall[e+i-2][l])}switch(this.wall[e+i-1][l].name){case"wall_mid":this.wall[e+i-1][l]=null;break;default:console.log("bottom mid -1",this.wall[e+i-1][l])}}switch(this.wall[e+i-2][t+s].name){case"wall_top_mid":this.wall[e+i-2][t+s]=this.registry.get("wall_corner_bottom_left");break;default:console.log("bottom right -2 -1",this.wall[e+i-2][t-1])}switch(this.wall[e+i-1][t+s].name){case"wall_mid":this.wall[e+i-1][t+s]=this.registry.get("wall_corner_front_left");break;default:console.log("bottom right 0 -1",this.wall[e+i-1][t-1])}for(let l=e+1;l<e+i-2;l++)this.wall[l][t-1]=this.registry.get("wall_side_mid_left"),this.wall[l][t+s]=this.registry.get("wall_side_mid_right")}replace(){this.replaceFloorRandomly(),this.replaceLadder(),this.replaceWallRandomly()}replaceFloorRandomly(){const t=["floor_2","floor_3","floor_4","floor_5","floor_6","floor_7","floor_8"];for(let e=0;e<this.h;e++)for(let s=0;s<this.w;s++)this.floor[e][s]&&this.rng.nextFloat()<.2&&(this.floor[e][s]=this.registry.get(this.rng.choice(t)))}replaceLadder(){const t=this.rooms[this.rooms.length-1],e=t.x+(t.w>>1),s=t.y+(t.h>>1);console.log(e,s,t),this.floor[s][e]=this.registry.get("floor_ladder")}replaceWallRandomly(){const t=["wall_hole_1","wall_hole_2","wall_banner_red","wall_banner_blue","wall_banner_green","wall_banner_yellow","wall_goo","wall_fountain_mid_red_anim","wall_fountain_mid_blue_anim"],e=["wall_hole_1","wall_hole_2"];for(let s=0;s<this.h;s++)for(let i=0;i<this.w;i++)if(this.wall[s][i])switch(this.wall[s][i].name){case"wall_mid":if(this.rng.nextFloat()<.2){let l;l=!!this.floor[s+1][i]?t:e;const h=this.rng.choice(l);switch(h){case"wall_goo":this.wall[s][i]=this.registry.get("wall_goo"),this.floor[s+1][i]=this.registry.get("wall_goo_base");break;case"wall_fountain_mid_red_anim":this.wall[s-1][i]=this.registry.get("wall_fountain_top"),this.wall[s][i]=this.registry.get("wall_fountain_mid_red_anim"),this.floor[s+1][i]=this.registry.get("wall_fountain_basin_red_anim");break;case"wall_fountain_mid_blue_anim":this.wall[s-1][i]=this.registry.get("wall_fountain_top"),this.wall[s][i]=this.registry.get("wall_fountain_mid_blue_anim"),this.floor[s+1][i]=this.registry.get("wall_fountain_basin_blue_anim");break;default:this.wall[s][i]=this.registry.get(h)}}}}exit(t){this.scene.setLevel(new n(this.rng,this.registry,this.scene,this.hero,this.level+1,t))}animate(t){this.hero.animate(t),this.boss&&this.boss.animate(t),this.monsterList.forEach(e=>e.animate(t))}}s.Level=n},{"./boss.monster":2,"./drop":4,"./tiny.monster":15}],10:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),function(t){t[t.Idle=0]="Idle",t[t.Run=1]="Run",t[t.Hit=2]="Hit"}(s.MonsterState||(s.MonsterState={}));s.MovingMonsterWrapper=class{constructor(t){this.monster=t}hitDamage(t,e,s){this.monster.hitDamage(t,e,s)}get x(){return this.monster.x}get y(){return this.monster.y}get new_x(){return this.monster.new_x}get new_y(){return this.monster.new_y}get is_left(){return this.monster.is_left}get frame(){return this.monster.frame}get start(){return this.monster.start}get speed(){return this.monster.speed}get tile(){return this.monster.tile}get state(){return this.monster.state}get weapon(){return this.monster.weapon}animate(t){}}},{}],11:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.Render=class{constructor(t="dungeon"){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.buffer=document.createElement("canvas"),this.b_ctx=this.buffer.getContext("2d"),this.b_ctx.imageSmoothingEnabled=!1}}},{}],12:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=2147483648;s.RNG=class{constructor(t=null){this.state=t||Math.floor(Math.random()*(i-1)),console.log("seed",this.state)}nextInt(){return this.state=(1103515245*this.state+12345)%i,this.state}nextFloat(){return this.nextInt()/(i-1)}nextRange(t,e){const s=e-t,l=this.nextInt()/i;return t+Math.floor(l*s)}choice(t){return t[this.nextRange(0,t.length)]}}},{}],13:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.SceneController=class{setScene(t){this.scene=t}render(t){this.scene.render(t)}}},{}],14:[function(t,e,s){"use strict";var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(l,h){function r(t){try{o(i.next(t))}catch(t){h(t)}}function n(t){try{o(i.throw(t))}catch(t){h(t)}}function o(t){var e;t.done?l(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,n)}o((i=i.apply(t,e||[])).next())}))};Object.defineProperty(s,"__esModule",{value:!0});s.TileRegistry=class{constructor(){this.tileMap={}}loadTileSet(){return i(this,void 0,void 0,(function*(){return yield new Promise(t=>{const e=new Image;e.onload=s=>t(e),e.src="0x72_DungeonTilesetII_v1.2.png"})}))}load(){return i(this,void 0,void 0,(function*(){const t=yield this.loadTileSet(),e=yield fetch("tiles_list_v1.1.txt");(yield e.text()).split(/(\r?\n)/g).forEach(e=>{let s=e.match(/([a-z0-9_]+) +([0-9]+) +([0-9]+) +([0-9]+) +([0-9]+) ?([0-9]?)/);if(s){const e=parseInt(s[2]),i=parseInt(s[3]),h=parseInt(s[4]),r=parseInt(s[5]),n=parseInt(s[6]||"0"),o=new l(t,s[1],e,i,h,r,n);this.tileMap[o.name]=o}})}))}get(t){return this.tileMap[t]}};class l{constructor(t,e,s,i,l,h,r){this.tileSet=t,this.name=e,this.x=s,this.y=i,this.w=l,this.h=h,this.numOfFrames=r,this.isAnim=this.numOfFrames>1}}s.Tile=l},{}],15:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const i=t("./monster");s.tinyMonsterNames=["tiny_zombie","goblin","imp","skeleton","muddy","swampy","zombie","ice_zombie"];s.TinyMonster=class{constructor(t,e,s,l,h,r,n){this.rng=t,this.registry=e,this.level=s,this.x=l,this.y=h,this.new_x=l,this.new_y=h,this.is_left=!1,this.name=r,this.healthMax=10,this.health=this.healthMax,this.damage=3,this.luck=.5,this.speed=100,this.setAnimation(i.MonsterState.Idle,n)}setAnimation(t,e){switch(t){case i.MonsterState.Idle:this.state=t,this.tile=this.registry.get(this.name+"_idle_anim"),this.frame=0,this.start=e;break;case i.MonsterState.Run:this.state=t,this.tile=this.registry.get(this.name+"_run_anim"),this.frame=0,this.start=e}}animate(t){if(this.frame=Math.floor((t-this.start)/this.speed),this.frame>=this.tile.numOfFrames){this.state===i.MonsterState.Run&&(this.level.monsters[this.y][this.x]=null,this.level.monsters[this.new_y][this.new_x]=this,this.x=this.new_x,this.y=this.new_y),this.setAnimation(i.MonsterState.Idle,t);const e=3,s=Math.max(0,this.x-e),l=Math.max(0,this.y-e),h=Math.min(this.level.w,this.x+e),r=Math.min(this.level.h,this.y+e);if(!this.level.hero.dead&&this.level.hero.x>=s&&this.level.hero.x<=h&&this.level.hero.y>=l&&this.level.hero.y<=r){const e=Math.abs(this.x-this.level.hero.x),s=Math.abs(this.y-this.level.hero.y);if(e>1){const e=Math.max(-1,Math.min(1,this.level.hero.x-this.x));if(this.move(e,0,t))return void console.log("move to hero x")}if(s>0){const e=Math.max(-1,Math.min(1,this.level.hero.y-this.y));if(this.move(0,e,t))return void console.log("move to hero y")}if(e<=1&&s<=1&&this.rng.nextFloat()<this.luck)return void this.level.hero.hitDamage(this.damage,this.name,t)}const n=.1;if(this.rng.nextFloat()<n){const e=this.rng.nextRange(-1,2),s=this.rng.nextRange(-1,2);if(this.move(e,s,t))return}}}move(t,e,s){if(this.is_left=t<0,this.state===i.MonsterState.Idle){const l=this.x+t,h=this.y+e;return!!this.level.floor[h][l]&&(!this.level.monsters[h][l]&&(this.level.monsters[h][l]=new i.MovingMonsterWrapper(this),this.new_x=l,this.new_y=h,this.setAnimation(i.MonsterState.Run,s),!0))}return!1}hitDamage(t,e,s){this.level.log.push(`${this.name} damaged ${t} by ${e}`),this.health=Math.max(0,this.health-t),this.health<=0&&(this.level.log.push(`${this.name} killed by ${e}`),this.level.monsters[this.y][this.x]=null,this.level.monsters[this.new_y][this.new_x]=null,this.level.monsterList=this.level.monsterList.filter(t=>t!==this),this.rng.nextFloat()<this.luck&&this.level.randomDrop(this.x,this.y))}}},{"./monster":10}]},{},[1]);
//# sourceMappingURL=bundle.js.map
